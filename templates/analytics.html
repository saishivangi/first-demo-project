{% extends "base.html" %}

{% block title %}Analytics - UPI Fraud Detection System{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header text-center">
                    <h2 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Fraud Detection Analytics Dashboard
                    </h2>
                    <p class="mt-2 mb-0 text-white-50">Comprehensive analysis and insights</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="row mt-4 g-4">
        <div class="col-md-3">
            <div class="stats-card border-primary">
                <div class="stats-number text-primary">99.8%</div>
                <h6 class="text-muted">Detection Accuracy</h6>
                <small class="text-success">
                    <i class="fas fa-arrow-up me-1"></i>+2.3% from last month
                </small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card border-success">
                <div class="stats-number text-success">1,24,567</div>
                <h6 class="text-muted">Transactions Analyzed</h6>
                <small class="text-primary">
                    <i class="fas fa-chart-line me-1"></i>Daily average: 4,152
                </small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card border-warning">
                <div class="stats-number text-warning">3,421</div>
                <h6 class="text-muted">Fraud Attempts Blocked</h6>
                <small class="text-danger">
                    <i class="fas fa-shield-alt me-1"></i>2.75% fraud rate
                </small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card border-info">
                <div class="stats-number text-info">₹8.7Cr</div>
                <h6 class="text-muted">Money Protected</h6>
                <small class="text-success">
                    <i class="fas fa-rupee-sign me-1"></i>Fraud prevented
                </small>
            </div>
        </div>
    </div>

    <!-- Charts and Analysis -->
    <div class="row mt-5 g-4">
        <!-- Fraud Detection Over Time -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-area me-2"></i>Fraud Detection Trends (Last 30 Days)
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="fraudTrendsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Fraud by Transaction Mode -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Fraud by Transaction Mode
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="transactionModeChart" width="200" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Risk Factors Analysis -->
    <div class="row mt-4 g-4">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Top Risk Factors
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>High Transaction Amount</span>
                            <span class="badge bg-danger">45%</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-danger" style="width: 45%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Late Night Transactions</span>
                            <span class="badge bg-warning">32%</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-warning" style="width: 32%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>New Account (< 30 days)</span>
                            <span class="badge bg-info">28%</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-info" style="width: 28%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>High Transaction Frequency</span>
                            <span class="badge bg-secondary">23%</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-secondary" style="width: 23%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-0">
                        <div class="d-flex justify-content-between">
                            <span>Weekend Transactions</span>
                            <span class="badge bg-success">18%</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: 18%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time-based Analysis -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-clock me-2"></i>Fraud by Time of Day
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="timeAnalysisChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- UPI Provider Analysis -->
    <div class="row mt-4 g-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-building me-2"></i>Fraud Analysis by UPI Provider
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>UPI Provider</th>
                                    <th>Total Transactions</th>
                                    <th>Fraud Cases</th>
                                    <th>Fraud Rate</th>
                                    <th>Risk Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><i class="fab fa-google text-primary me-2"></i>GooglePay</td>
                                    <td>45,230</td>
                                    <td>987</td>
                                    <td>2.18%</td>
                                    <td><span class="badge bg-success">Low</span></td>
                                </tr>
                                <tr>
                                    <td><i class="fas fa-mobile-alt text-success me-2"></i>PhonePe</td>
                                    <td>38,567</td>
                                    <td>1,124</td>
                                    <td>2.91%</td>
                                    <td><span class="badge bg-warning">Medium</span></td>
                                </tr>
                                <tr>
                                    <td><i class="fas fa-wallet text-info me-2"></i>Paytm</td>
                                    <td>32,190</td>
                                    <td>876</td>
                                    <td>2.72%</td>
                                    <td><span class="badge bg-warning">Medium</span></td>
                                </tr>
                                <tr>
                                    <td><i class="fas fa-university text-primary me-2"></i>YBL (Yes Bank)</td>
                                    <td>8,580</td>
                                    <td>434</td>
                                    <td>5.06%</td>
                                    <td><span class="badge bg-danger">High</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Amount Range Analysis -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-rupee-sign me-2"></i>Fraud by Amount Range
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="amountRangeChart" width="200" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Alerts -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bell me-2"></i>Recent Fraud Alerts (Last 24 Hours)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Sender UPI</th>
                                    <th>Receiver UPI</th>
                                    <th>Amount</th>
                                    <th>Risk Score</th>
                                    <th>Action Taken</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-danger">
                                    <td>2 hours ago</td>
                                    <td>suspect123@phonepe</td>
                                    <td>unknown456@ybl</td>
                                    <td>₹85,000</td>
                                    <td><span class="badge bg-danger">High (92%)</span></td>
                                    <td><span class="badge bg-danger">Blocked</span></td>
                                </tr>
                                <tr class="table-warning">
                                    <td>4 hours ago</td>
                                    <td>newuser789@paytm</td>
                                    <td>merchant@googlepay</td>
                                    <td>₹45,500</td>
                                    <td><span class="badge bg-warning">Medium (76%)</span></td>
                                    <td><span class="badge bg-warning">Flagged</span></td>
                                </tr>
                                <tr class="table-danger">
                                    <td>6 hours ago</td>
                                    <td>test.user@okaxis</td>
                                    <td>random@phonepe</td>
                                    <td>₹99,999</td>
                                    <td><span class="badge bg-danger">High (95%)</span></td>
                                    <td><span class="badge bg-danger">Blocked</span></td>
                                </tr>
                                <tr class="table-info">
                                    <td>8 hours ago</td>
                                    <td>regular.customer@googlepay</td>
                                    <td>shop.owner@paytm</td>
                                    <td>₹2,500</td>
                                    <td><span class="badge bg-success">Low (15%)</span></td>
                                    <td><span class="badge bg-success">Approved</span></td>
                                </tr>
                                <tr class="table-warning">
                                    <td>12 hours ago</td>
                                    <td>suspicious@ybl</td>
                                    <td>account@phonepe</td>
                                    <td>₹67,800</td>
                                    <td><span class="badge bg-warning">Medium (68%)</span></td>
                                    <td><span class="badge bg-warning">Under Review</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Performance -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-brain me-2"></i>Model Performance Metrics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <h4 class="text-primary">99.8%</h4>
                            <p>Accuracy</p>
                        </div>
                        <div class="col-md-3 text-center">
                            <h4 class="text-success">98.7%</h4>
                            <p>Precision</p>
                        </div>
                        <div class="col-md-3 text-center">
                            <h4 class="text-info">99.2%</h4>
                            <p>Recall</p>
                        </div>
                        <div class="col-md-3 text-center">
                            <h4 class="text-warning">98.9%</h4>
                            <p>F1-Score</p>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Model Information:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Ensemble of Random Forest + Gradient Boosting</li>
                                <li><i class="fas fa-check text-success me-2"></i>15+ engineered features</li>
                                <li><i class="fas fa-check text-success me-2"></i>Real-time processing</li>
                                <li><i class="fas fa-check text-success me-2"></i>Continuous learning enabled</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Last Updated:</h6>
                            <p class="text-muted">{{ "now"|strftime('%B %d, %Y at %I:%M %p') }}</p>
                            
                            <h6>Training Data Size:</h6>
                            <p class="text-muted">1,000,000+ synthetic transactions</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Fraud Trends Chart
const fraudTrendsCtx = document.getElementById('fraudTrendsChart').getContext('2d');
const fraudTrendsChart = new Chart(fraudTrendsCtx, {
    type: 'line',
    data: {
        labels: ['Jan 1', 'Jan 5', 'Jan 10', 'Jan 15', 'Jan 20', 'Jan 25', 'Jan 30'],
        datasets: [{
            label: 'Fraud Detected',
            data: [45, 52, 38, 61, 47, 55, 43],
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4
        }, {
            label: 'Total Transactions',
            data: [1200, 1350, 1180, 1420, 1290, 1380, 1250],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Transaction Mode Chart
const transactionModeCtx = document.getElementById('transactionModeChart').getContext('2d');
const transactionModeChart = new Chart(transactionModeCtx, {
    type: 'doughnut',
    data: {
        labels: ['UPI PIN', 'QR Code', 'Biometric', 'Bank Transfer', 'Mobile Banking'],
        datasets: [{
            data: [35, 28, 15, 12, 10],
            backgroundColor: [
                'rgb(239, 68, 68)',
                'rgb(245, 158, 11)',
                'rgb(59, 130, 246)',
                'rgb(16, 185, 129)',
                'rgb(139, 92, 246)'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// Time Analysis Chart
const timeAnalysisCtx = document.getElementById('timeAnalysisChart').getContext('2d');
const timeAnalysisChart = new Chart(timeAnalysisCtx, {
    type: 'bar',
    data: {
        labels: ['0-6', '6-12', '12-18', '18-24'],
        datasets: [{
            label: 'Fraud Incidents',
            data: [85, 23, 35, 67],
            backgroundColor: 'rgba(239, 68, 68, 0.8)',
            borderColor: 'rgb(239, 68, 68)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Number of Fraud Cases'
                }
            },
            x: {
                title: {
                    display: true,
                    text: 'Time Range (Hours)'
                }
            }
        }
    }
});

// Amount Range Chart
const amountRangeCtx = document.getElementById('amountRangeChart').getContext('2d');
const amountRangeChart = new Chart(amountRangeCtx, {
    type: 'pie',
    data: {
        labels: ['₹1-100', '₹100-1K', '₹1K-10K', '₹10K-50K', '₹50K+'],
        datasets: [{
            data: [5, 15, 35, 30, 15],
            backgroundColor: [
                'rgb(16, 185, 129)',
                'rgb(59, 130, 246)',
                'rgb(245, 158, 11)',
                'rgb(239, 68, 68)',
                'rgb(139, 92, 246)'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// Auto-refresh data every 30 seconds (simulation)
setInterval(function() {
    // In a real application, you would fetch new data from the server
    console.log('Refreshing analytics data...');
}, 30000);
</script>
{% endblock %}